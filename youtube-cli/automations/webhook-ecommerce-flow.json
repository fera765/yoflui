{
  "id": "webhook-ecommerce-flow",
  "version": "1.0.0",
  "metadata": {
    "name": "E-commerce Webhook Flow",
    "description": "Processa webhooks de e-commerce, valida dados, roteia fluxos e notifica APIs",
    "author": "FLUI Team",
    "created": "2025-11-04",
    "tags": ["webhook", "ecommerce", "api", "complex"],
    "category": "integrations"
  },
  "triggers": [
    {
      "type": "contains",
      "pattern": "ecommerce"
    }
  ],
  "variables": {
    "acao": {"type": "string", "defaultValue": "COMPRAR"},
    "produto": {"type": "string", "defaultValue": "FLUI Pro License"},
    "email": {"type": "string", "defaultValue": "cliente@example.com"},
    "valor": {"type": "string", "defaultValue": "299.00"},
    "nextFlow": {"type": "string", "defaultValue": ""},
    "apiResponse": {"type": "string", "defaultValue": ""}
  },
  "steps": [
    {
      "id": "1",
      "type": "log",
      "message": "ðŸ”” Webhook E-commerce recebido: ${variables.acao}",
      "level": "info"
    },
    {
      "id": "2",
      "type": "tool",
      "toolName": "condition",
      "toolArgs": {
        "value": "${variables.acao}",
        "conditions": [
          {"pattern": "COMPRAR", "nextFlow": "processar-compra", "matchType": "contains"},
          {"pattern": "CANCELAR", "nextFlow": "processar-cancelamento", "matchType": "contains"},
          {"pattern": "SUPORTE", "nextFlow": "abrir-ticket", "matchType": "contains"}
        ],
        "defaultFlow": "log-desconhecido",
        "caseSensitive": false
      }
    },
    {
      "id": "3",
      "type": "log",
      "message": "ðŸ“Š Validando dados: ${variables.produto} | ${variables.email} | R$ ${variables.valor}",
      "level": "info"
    },
    {
      "id": "4",
      "type": "tool",
      "toolName": "write_file",
      "toolArgs": {
        "file_path": "ecommerce-log-${Date.now()}.json",
        "content": "{\"acao\": \"${variables.acao}\", \"produto\": \"${variables.produto}\", \"email\": \"${variables.email}\", \"valor\": \"${variables.valor}\", \"timestamp\": ${Date.now()}}"
      }
    },
    {
      "id": "5",
      "type": "tool",
      "toolName": "trigger_webhook",
      "toolArgs": {
        "url": "https://httpbin.org/post",
        "method": "POST",
        "payload": {
          "tipo": "compra",
          "produto": "${variables.produto}",
          "email": "${variables.email}",
          "valor": "${variables.valor}",
          "origem": "webhook-flui"
        },
        "headers": {
          "Content-Type": "application/json",
          "X-Source": "FLUI-Automation"
        },
        "timeout": 15000
      }
    },
    {
      "id": "6",
      "type": "log",
      "message": "âœ… Webhook processado e API notificada com sucesso!",
      "level": "success"
    }
  ],
  "errorHandling": {
    "onStepError": "skip",
    "maxRetries": 2,
    "logErrors": true
  }
}
